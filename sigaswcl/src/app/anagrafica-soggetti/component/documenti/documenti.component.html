<sigas-alert *ngIf="erroreCaricamento" [message]="erroreUpload" [type]="'DANGER'"></sigas-alert>

<div class="principal-div">

    <sigas-spinner *ngIf="loaderPage"></sigas-spinner>

    <div *ngIf="!loaderPage">

        <div [ngStyle]="{'display': !nuovoDocumento && !updateDocumento ? 'block' : 'none'}" class="contains">

            <div class="d-flex justify-content-center">
                <h4 class="title">Documentazione soggetto</h4>
            </div>
            <sigas-alert *ngIf="showMsg" [message]="message" [type]="levelMessage"></sigas-alert>

            <div class="container main-div">

                <div class="up-div">
                    <div class="row p-4 ">
                        <div class="col-lg-4">
                            <label for="stato">Tipo:</label>
                            <select (change)="changeFilter()" [(ngModel)]="tipologia"
                                    class="form-control up-row-input col-lg-8"
                                    name="tipologia"
                                    required>
                                <option>Tutte</option>
                                <option *ngFor="let tipo of listaTipologie" [ngValue]="tipo.idTipoComunicazione">
                                    {{tipo.denominazione}}</option>
                            </select>
                        </div>
                        <div class="col-lg-4">
                            <label for="stato">Anno:</label>
                            <select (change)="changeFilter()" [(ngModel)]="annoDocumento"
                                    class="form-control up-row-input col-lg-4"
                                    name="annoDocumento" required>
                                <option>Tutti</option>
                                <option *ngFor="let anno of listaAnni" [value]="anno">
                                    {{ anno }}</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-lg-12">
                        <div class="form-group col-lg-12">
                            <div class="form-group col-lg-12">

                                <!-- LOADER -->
                                <sigas-spinner-form *ngIf="loaderDT" [diameter]="30"></sigas-spinner-form>

                                <!-- TABELLA DOCUMENTI -->
                                <table [dtOptions]="dtOptions"
                                       [dtTrigger]="dtTrigger"
                                       [style.display]="!loaderDT ? '' : 'none' "
                                       class="row-border hover"
                                       datatable id="elenco-documenti"
                                       width="100%">
                                    <thead>
                                        <tr>
                                            <th class="upper-th">Data</th>
                                            <th class="upper-th">Tipologia</th>
                                            <th class="upper-th no-sort">Annualità</th>
                                            <th class="upper-th no-sort">Dati riassuntivi</th>
                                            <th class="upper-th no-sort"></th>
                                            <th class="upper-th no-sort">Download</th>
                                            <th class="upper-th no-sort">Allarme</th>
                                            <th class="upper-th no-sort"></th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <ng-container *ngFor="let el of listaDocumenti; index as i">

                                            <!-- COLONNE DI DEFAULT -->
                                            <tr class="pointer">
                                                <td (click)="dettaglioDocumento(el)" class="first-td">{{ el.dataDocumento | date :'dd/MM/yyy'}}</td>
                                                <td (click)="dettaglioDocumento(el)" class="all-td">{{ el.tipoComunicazioneVO.denominazione }}</td>
                                                <td (click)="dettaglioDocumento(el)" class="all-td center-text-td">{{ el.annualita }}</td>
                                                <td (click)="dettaglioDocumento(el)" class="dettagli-td">{{ el.datiRiassuntivi}}</td>
                                                <td>
                                                    <a *ngIf="el.allegati"
                                                       [attr.aria-controls]="'collapse-' + i"
                                                       [attr.aria-expanded]="false"
                                                       [attr.data-target]="'#collapse-' + i"
                                                       class="accordion-toggle collapsed"
                                                       data-toggle="collapse">
                                                    </a>
                                                </td>
                                                <td class="dettagli-td">
                                                    <a *ngIf="!el.allegati" class="btn btn-success"
                                                       download="{{ el.descrizione }}"
                                                       href="{{this.anagraficaSoggettiService.getUrlScaricaDocumentoMaster()+el.descrizione}}"
                                                       style="width: 100px;">Scarica </a>
                                                    <a *ngIf="el.allegati" class="btn btn-success mb-1"
                                                       download="{{ el.descrizione }}"
                                                       href="{{this.anagraficaSoggettiService.getUrlScaricaDocumentoMaster()+el.descrizione}}"
                                                       style="width: 100px;height: 30px;">Scarica </a>
                                                    <a *ngIf="el.allegati" class="btn btn-success"
                                                       download="{{el.tipoComunicazioneVO.denominazione}}_{{el.dataDocumento}}.zip"
                                                       href="{{this.anagraficaSoggettiService.getUrlScaricaDocumento()+el.descrizione}}"
                                                       style="width: 100px;">Scarica
                                                        pacchetto </a>
                                                </td>
                                                <td (click)="dettaglioDocumento(el)" class="all-td">
                                                    <label class="switch-small margin-icon">
                                                        <input [(ngModel)]="el.allarmeOn" disabled type="checkbox">
                                                        <span class="slider-small round">
                                  <span *ngIf="el.allarmeOn" class="switch-on-small">ON</span>
                                  <span *ngIf="!el.allarmeOn" class="switch-off-small">OFF</span>
                              </span>
                                                    </label>
                                                </td>
                                                <td>
                                                    <!-- ELIMINA DOCUMENTO -->
                                                    <button (click)="confermaEliminaDocumento(el.idComunicazione)"
                                                            class="btn btn-danger btn-sm margin-icon"
                                                            title="Elimina documento">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>

                                            <!-- ALLEGATI DOCUMENTO -->
                                            <tr class="collapse-row container collapse out"
                                                *ngFor="let al of el.allegati"
                                                colspan="7"
                                                [attr.id]="'collapse-' + i">
                                                <td class="col"></td>
                                                <td class="col">Allegato Acta</td>
                                                <td class="col"></td>
                                                <td class="dettagli-subTable-td">{{al.fileName}}</td>
                                                <td style="width: 3%;"></td>
                                                <td class="col">
                                                    <a class="btn btn-success mb-1"
                                                       download="{{ al.nomeFile }}"
                                                       href="{{this.anagraficaSoggettiService.getUrlScaricaDocumentoAllegato(el.descrizione,al.fileName)}}"
                                                       style="width: 90px;">Scarica
                                                    </a>
                                                </td>
                                                <td style="width: 7%;"></td>
                                                <td style="width: 7%;"></td>
                                            </tr>

                                        </ng-container>
                                    </tbody>
                                </table>
                    </div>
                </div>
            </div>
        </div>

        <sigas-dialog [buttonAnnullaText]="buttonAnnullaText" [buttonConfirmText]="buttonConfirmText"
                      [testo]="messageDialog"
                      [titolo]="'Attenzione'"></sigas-dialog>

    </div>

    <div class="bs-example" data-example-id="single-button-dropdown">
        <div class="form-group row col-lg-12">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                <div class="btn-group">
                    <a (click)="goBackMain()" class="btn btn-default pointer margin-icon" role="button">
                        <i class="fa fa-angle-left"></i>
                        indietro</a>
                </div>
                <div class="btn-group">
                    <button (click)="onClickNuovo()" *ngIf="!nuovoDocumento && !updateDocumento"
                            class="btn btn-primary margin-icon btn-standard"
                            type="button">
                        <i class="fas fa-angle-down"></i> Nuovo documento
                    </button>
                </div>
                <div class="btn-group">
                    <button (click)="goExcel()" *ngIf="!loaderExcel && !nuovoDocumento && !loaderExcel"
                            class="btn btn-success margin-icon pointer" type="button">
                        <i class="far fa-file-excel"></i> Scarica in Excel
                    </button>
                    <button *ngIf="loaderExcel" class="btn btn-success" type="button">
                        <sigas-spinner-form [diameter]="20"></sigas-spinner-form>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div>
    <form #insUpdateDocumento="ngForm" *ngIf="updateDocumento">
        <div class="contains">
            <div class="d-flex justify-content-center">
                <h4 class="title">Modifica documento</h4>
            </div>
            <div class="container main-div">
                <div class="up-div">
                    <div class="form-group row">
                        <label class="mt-2 col-md-auto" for="tipologia">Tipologia:</label>
                        <div class="col-sm-2">
                            <select (change)="setTipologiaDocumento($event.target.value)"
                                    [(ngModel)]="documentoToSave.tipoComunicazioneVO.idTipoComunicazione"
                                    class="form-control"
                                    id="tipologiaDoc"
                                    name="tipologiaDoc" required>
                                <option *ngFor="let tipologia of listaTipologie"
                                        [value]="tipologia.idTipoComunicazione">
                                    {{tipologia.denominazione}}</option>
                            </select>
                        </div>
                        <label class="mt-2 col-md-auto" for="annualita">Annualità di riferimento:</label>
                        <div class="col-md-auto">
                            <select [(ngModel)]="documentoToSave.annualita" class="form-control"
                                    id="annoDocumento" name="annoDocumento" required>
                                <option *ngFor="let anno of listaAnni" [value]="anno">
                                    {{ anno }}</option>
                            </select>
                        </div>
                        <label class="mt-2 col-md-auto" for="dataDocum">Data documento:</label>
                        <!--  <input type="date" class="form-control first-row-input col-lg-6" value="{{documentoToSave.dataDocumento}}"
                           [(ngModel)]=documentoToSave.dataDocumento name="dataDocumento" #dataDocumento="ngModel" required>  -->
                        <div class="col-sm-3">
                            <div class="input-group">


                                <input #dataDocum="ngbDatepicker"
                                       (click)="dataDocum.toggle()"
                                       [(ngModel)]="dataDocumentoPicker"
                                       [footerTemplate]="footerTemplateDataDoc"
                                       class="form-control col-mg-8 col-lg-4 "
                                       class="form-control"
                                       id="dataDocum"
                                       name="dataDocum"
                                       ngbDatepicker
                                       placeholder="gg/mm/aaaa"
                                       readonly
                                       required>
                                <ng-template #footerTemplateDataDoc>
                                    <hr class="my-0">
                                    <button (click)="dataDocumentoPicker = null; dataDocum.close();"
                                            class="btn btn-primary btn-sm m-2 float-left">Pulisci
                                    </button>
                                    <button (click)="dataDocum.close();"
                                            class="btn btn-secondary btn-sm m-2 float-right">Chiudi
                                    </button>
                                </ng-template>
                                <div class="input-group-append">
                                    <button (click)="dataDocum.toggle()" class="btn btn-outline-secondary calendar"
                                            type="button">
                                        <svg _ngcontent-c4="" aria-hidden="true"
                                             class="svg-inline--fa fa-calendar-alt fa-w-14" data-fa-i2svg=""
                                             data-icon="calendar-alt"
                                             data-prefix="far" focusable="false" role="img"
                                             viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"
                                                  fill="currentColor"></path>
                                        </svg>
                                        <!--<i class="far fa-calendar-alt"></i>-->
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="row p-4 ">
                        <div class="col-lg-4">
                            <label for="protocollo">Protocollo:</label>
                            <input #nprotocollo="ngModel" [(ngModel)]="documentoToSave.nprotocollo"
                                   class="form-control first-row-input col-lg-7"
                                   name="nprotocollo" placeholder="nprotocollo" required
                                   type="text">
                        </div>
                    </div>
                    <div class="row p-4 ">
                        <div class="col-lg-8">
                            <label for="note" id="label-note">Dati riassuntivi:</label>
                            <div class="col-lg-10 col-value note-div">
                    <textarea [(ngModel)]="documentoToSave.datiRiassuntivi" [ngModelOptions]="{standalone: true}"
                              class="note-textarea" id="note"
                              rows="4"></textarea>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <label for="note">Allarme:</label>
                            <label class="switch-small margin-icon">
                                <input (click)="modButtonAllarme()" [(ngModel)]="documentoToSave.allarmeOn"
                                       name="allarmeOn"
                                       type="checkbox">
                                <span class="slider-small round">
                      <span *ngIf="documentoToSave.allarmeOn" class="switch-on-small">ON</span>
                      <span *ngIf="!documentoToSave.allarmeOn" class="switch-off-small">OFF</span>
                    </span>
                            </label>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <label class="label-file" for="file">File allegato: </label>
                        <div class="form-group upload-div upload-btn-wrapper">
                            <input (change)="handleFileInput($event.target.files)" class="input-upload" id="file"
                                   type="file">
                            <button class="btn btn-primary pull-right" type="button">
                                <i class="fas fa-check"></i> Carica allegato
                            </button>
                        </div>
                        <div *ngIf="fileCaricato" class="col-lg-5 col-md-12 col-sm-12 col-xs-12 text-center">
                            <label class="col-form-label" for="selectedFile">File selezionato:</label>
                            <span *ngIf="fileCaricato && fileModificato"
                                  id="reSelectedFile"> {{ fileToUpload ? fileToUpload.name : '' }}</span>
                            <span *ngIf="fileCaricato && !fileModificato"
                                  id="updateSelectedFile"> {{ documentoToSave.descrizione }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bs-example" data-example-id="single-button-dropdown">
            <div class="form-group row col-lg-12">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                    <div class="btn-group">
                        <a (click)="goBack()" class="btn btn-default pointer margin-icon" role="button">
                            <i class="fa fa-angle-left"></i>
                            indietro</a>
                    </div>
                    <div class="btn-group">
                        <button (click)="onClickUpdate()" *ngIf="updateDocumento" [disabled]="!fileCaricato"
                                class="btn btn-primary margin-icon btn-standard" type="button">
                            <i class="fas fa-angle-down"></i> Aggiorna documento
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div>
    <form #insNuovoDocumento="ngForm" [ngStyle]="{'display': nuovoDocumento == true ? 'block' : 'none'}">
        <div class="contains">
            <div class="d-flex justify-content-center">
                <h4 class="title">Nuovo documento</h4>
            </div>
            <div class="container main-div">
                <div class="up-div">
                    <div class="form-group row">

                        <label class="mt-2 col-md-auto" for="tipologiaDoc">Tipologia:</label>
                        <div class="col-sm-2">
                            <select (change)="setTipologiaDocumento($event.target.value)"
                                    [(ngModel)]="documentoToSave.tipoComunicazioneVO.idTipoComunicazione"
                                    class="form-control"
                                    id="tipologiaDoc"
                                    name="tipologiaDoc" required>
                                <option *ngFor="let tipologia of listaTipologie"
                                        [value]="tipologia.idTipoComunicazione">
                                    {{tipologia.denominazione}}</option>
                            </select>
                        </div>
                        <label class="mt-2 col-md-auto" for="annoDocumento">Annualità di riferimento:</label>
                        <div class="col-md-auto">
                            <select [(ngModel)]="documentoToSave.annualita" class="form-control"
                                    id="annoDocumento" name="annoDocumento" required>
                                <option *ngFor="let anno of listaAnni" [value]="anno">
                                    {{ anno }}</option>
                            </select>
                        </div>
                        <label class="mt-2  col-md-auto" for="dataDocum">Data documento:</label>
                        <!--  <input type="date" class="form-control first-row-input col-lg-6" value="{{documentoToSave.dataDocumento}}"
                           [(ngModel)]=documentoToSave.dataDocumento name="dataDocumento" #dataDocumento="ngModel" required>  -->
                        <div class="col-sm-3">
                            <div class="input-group">


                                <input #dataDocum="ngbDatepicker"
                                       (click)="dataDocum.toggle()"
                                       [(ngModel)]="dataDocumentoPicker"
                                       [footerTemplate]="footerTemplateDataDoc"
                                       class="form-control col-mg-8 col-lg-4 "
                                       class="form-control"
                                       id="dataDocum"
                                       name="dataDocum"
                                       ngbDatepicker
                                       placeholder="gg/mm/aaaa"
                                       readonly
                                       required>
                                <ng-template #footerTemplateDataDoc>
                                    <hr class="my-0">
                                    <button (click)="dataDocumentoPicker = null; dataDocum.close();"
                                            class="btn btn-primary btn-sm m-2 float-left">Pulisci
                                    </button>
                                    <button (click)="dataDocum.close();"
                                            class="btn btn-secondary btn-sm m-2 float-right">Chiudi
                                    </button>
                                </ng-template>
                                <div class="input-group-append">
                                    <button (click)="dataDocum.toggle()" class="btn btn-outline-secondary calendar"
                                            type="button">
                                        <svg _ngcontent-c4="" aria-hidden="true"
                                             class="svg-inline--fa fa-calendar-alt fa-w-14" data-fa-i2svg=""
                                             data-icon="calendar-alt"
                                             data-prefix="far" focusable="false" role="img"
                                             viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"
                                                  fill="currentColor"></path>
                                        </svg>
                                        <!--<i class="far fa-calendar-alt"></i>-->
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row p-4 ">
                        <div class="col-lg-4">
                            <label for="protocollo">Protocollo:</label>
                            <input #nprotocollo="ngModel" [(ngModel)]="documentoToSave.nprotocollo"
                                   class="form-control first-row-input col-lg-7"
                                   name="nprotocollo" placeholder="nprotocollo" required
                                   type="text">
                        </div>
                    </div>
                    <div class="row p-4 ">
                        <div class="col-lg-8">
                            <label for="note" id="label-note">Dati riassuntivi:</label>
                            <div class="col-lg-10 col-value note-div">
                    <textarea [(ngModel)]="documentoToSave.datiRiassuntivi" [ngModelOptions]="{standalone: true}"
                              class="note-textarea" id="note"
                              rows="4"></textarea>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <label for="note">Allarme:</label>
                            <label class="switch-small margin-icon">
                                <input (click)="modButtonAllarme()" [(ngModel)]="documentoToSave.allarmeOn"
                                       name="allarmeOn"
                                       type="checkbox">
                                <span class="slider-small round">
                      <span *ngIf="documentoToSave.allarmeOn" class="switch-on-small">ON</span>
                      <span *ngIf="!documentoToSave.allarmeOn" class="switch-off-small">OFF</span>
                    </span>
                            </label>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <label class="label-file" for="file">File allegato: </label>
                        <div class="form-group upload-div upload-btn-wrapper">
                            <input #utfFileRef (change)="handleFileInput($event.target.files)" class="input-upload"
                                   id="file"
                                   type="file">
                            <button class="btn btn-primary pull-right" type="button">
                                <i class="fas fa-check"></i> Carica allegato
                            </button>
                        </div>
                        <div *ngIf="fileCaricato" class="col-lg-5 col-md-12 col-sm-12 col-xs-12 text-center">
                            <label class="col-form-label" for="selectedFile">File selezionato:</label>
                            <span *ngIf="fileCaricato && fileModificato"
                                  id="newSelectedFile"> {{ fileToUpload ? fileToUpload.name : '' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bs-example" data-example-id="single-button-dropdown">
            <div class="form-group row col-lg-12">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                    <div class="btn-group">
                        <a (click)="goBack()" class="btn btn-default pointer margin-icon" role="button">
                            <i class="fa fa-angle-left"></i>
                            indietro</a>
                    </div>
                    <div class="btn-group">
                        <button (click)="onClickSalva()" class="btn btn-primary margin-icon btn-standard"
                                type="button">
                            <i class="fas fa-angle-down"></i> Salva documento
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

</div>
</div>
