<div class="principal-div">
  <sigas-spinner *ngIf="loaderPage"></sigas-spinner>
  <div *ngIf="!loaderPage">
  <div class="card card-primary center-default">
    <div class="card-header text-white">
      <strong>Inserisci Documentazione</strong> </div>
    <form #praticaDocumentazione="ngForm">
      <sigas-alert [message]="'Valorizza i campi per la documentazione'"
        [type]="'INFO'"></sigas-alert>
       <div class="card-body container">    
        <sigas-alert [message]="message" *ngIf="showMessage" [type]="levelMessage"></sigas-alert>
            
                            <div class="form-group col-lg-12">
                                <sigas-spinner-form [diameter]="30" *ngIf="loaderDT"></sigas-spinner-form>
                                <div id="accordion" *ngIf="!loaderDT">
								
								        <div class="form-group row">
								        
		                                  <div class="col-lg-4 hight">
		                                      <div class="form-group row">
		                                          <label class="col-lg-5 col-form-label">Azienda</label>
		                                          <div class="col-lg-7">
		                                                 <select class="form-control" id="azienda" [(ngModel)]="documentoToSave.anagraficaSoggettoVO" 
		                                                     name="azienda" (change)="changeAzienda($event)" required>
		                                                      <option *ngFor="let azienda of listaAziende" [ngValue]="azienda">{{azienda.denominazione}}</option>
		                                                 </select>
		                                          </div>
		                                      </div>
		                                  </div>
								              
								            
								            <div class="col-lg-4 hight">
								            <div class="form-group row">
												<label for="codiceFiscalePIva" class="col-lg-6 col-form-label">Codice Fiscale/P.Iva:</label>
						                        <div class="col-lg-6">
						                            <input type="text" id="codiceFiscalePIva" placeholder="Codice Fiscale/P.Iva" [(ngModel)]="documentoToSave.cfPiva" name="codiceFiscalePIva"
						                                class="form-control maiuscolo"  [disabled]="cfPivaEsistente" required>						                            
						                        </div>
						                        </div>
					                        </div>
					                        
					                        <div class="col-lg-4 hight">
						                        <div class="form-group row">
							                        <label for="anno" class="col-lg-8 col-form-label">Annualit√† di riferimento</label>
							                        <div class="col-lg-4">
														<select class="form-control" id="year" [(ngModel)]="documentoToSave.annualita" name="year" [required]="rimborso" >
															<option *ngFor="let year of yearsList" [value]="year">{{year}}</option>
														</select>
													</div>
												</div>
											</div>
											
											
              
								        </div>
								        
								        
								        
								        
  								        <div class="form-group row">
	  								        <div class="col-lg-20 hight">
								                <div class="form-group row">
								                  <label for="protocollo" class="col-lg-6 col-form-label">Protocollo di riferimento:</label>
								                  <div class="col-lg-6">
									                  <input type="text"
															 class="form-control"
															 placeholder="nnnnnnnn/aaaa"
															 [pattern]="riferimentoProtocolloRegex"
									                    [(ngModel)]="documentoToSave.rifArchivio" name="rifArchivio"  >
								                    </div>
								                </div>
								              </div>
										        <div class="col-lg-6 hight">
				                                      <div class="form-group row">
				                                          <label class="col-lg-4 col-form-label">Tipo Documento</label>
				                                          <div class="col-lg-8">
				                                                 <select class="form-control" id="tipoDocumento" [(ngModel)]="documentoToSave.tipoDocumentoVO" 
				                                                     name="tipoDocumento" (change)="changeTipoDocumento($event)" required>
				                                                      <option *ngFor="let tipoDocumento of listaTipoDocumentoMacro" [ngValue]="tipoDocumento">{{tipoDocumento.descrizione}}</option>
				                                                 </select>
				                                          </div>
				                                      </div>
				                                  </div>
		                                  </div>
		                                  
		                                  
		                                   <div class="form-group row" *ngIf="comunicazioniVarie">
										        <div class="col-lg-6 hight">
				                                      <div class="form-group row">
				                                          <label class="col-lg-4 col-form-label">Tipo Comunicazione</label>
				                                          <div class="col-lg-8">
				                                                 <select class="form-control" id="tipoComunicazione" [(ngModel)]="documentoToSave.tipoComunicazioneVO" 
				                                                     name="tipoComunicazione" required>
				                                                      <option *ngFor="let tipoComunicazione of listaTipoComunicazione" [ngValue]="tipoComunicazione">{{tipoComunicazione.descrizione}}</option>
				                                                 </select>
				                                          </div>
				                                      </div>
				                                  </div>
		                                  </div>
		                                  
		                                  <div class="form-group row" *ngIf="rimborso">
										        <div class="col-lg-6 hight">
				                                      <div class="form-group row">
				                                          <label class="col-lg-4 col-form-label">Tipo Rimborso</label>
				                                          <div class="col-lg-8">
				                                                 <select class="form-control" id="tipoRimborso" [(ngModel)]="documentoToSave.tipoRimborsoVO" 
				                                                     name="tipoRimborso" required>
				                                                      <option *ngFor="let tipoRimborso of listaTipoRimborso" [ngValue]="tipoRimborso">{{tipoRimborso.descrizione}}</option>
				                                                 </select>
				                                          </div>
				                                      </div>
				                                  </div>
		                                  </div>
		                                  
		                                  
		                                  <div class="form-group row" *ngIf="accertamento">
	  								        <div class="col-lg-20 hight">
								                <div class="form-group row">
								                  <label for="protocollo" class="col-lg-6 col-form-label">Protocollo atto Accertamento:</label>
								                  <div class="col-lg-6">
									                  <input type="text" class="form-control" placeholder="nnnnnnnnn/aaaa"
									                    [(ngModel)]="documentoToSave.nProtocolloAccertamento" name="nProtocolloAccertamento"  required>
								                    </div>
								                </div>
								              </div>
										        <div class="col-lg-6 hight">
				                                      <div class="form-group row">
				                                          <label class="col-lg-4 col-form-label">Anno protocollazione atto accertamento</label>
				                                          <div class="col-lg-8">
				                                                 <select class="form-control" id="yearAccertamento" [(ngModel)]="documentoToSave.annoProtocolloAccertamento" 
				                                                     name="yearAccertamento"  required>
				                                                      <option *ngFor="let yearAcc of yearsListAccertamento" [ngValue]="yearAcc">{{yearAcc}}</option>
				                                                 </select>
				                                          </div>
				                                      </div>
				                                  </div>
		                                  </div>
		                                  
		                                  <div class="form-group row">
		                                  
		                                  
		                                  <div class="col-lg-8">
							                  <label id="label-note" for="note">Note:</label>
							                  <div class="col-lg-10 col-value note-div">
							                    <textarea class="note-textarea" rows="4" [(ngModel)]="documentoToSave.note" id="note"
							                      [ngModelOptions]="{standalone: true}"></textarea>
							                  </div>
							                </div>
              
								        </div>
								        
								        
								        <div class="form-group row">
		                                  
		                                  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
									            <h5 class="border-title">
									                <strong>Documento Principale </strong> 
									            </h5>
									        </div>
		                                  <div class="col-lg-4">
							                <label class="label-file" for="file">File allegato: </label>
							                <div class="form-group upload-div upload-btn-wrapper">
							                  <input class="input-upload" type="file" id="file"
							                    (change)="handleFileInput($event.target.files)" required>
							                  <button type="button" class="btn btn-primary pull-right">
							                    <i class="fas fa-check"></i>  Carica Documento Principale</button>
							                </div>
							                
							              </div>
							              </div>
							              <div class="form-group row">
							              <div class="col-lg-4">
							              <div *ngIf="fileCaricato" class="row  text-center">
							                	
							                     <table class="table" *ngIf="fileCaricato" >
									                
									                <tbody>
									                <tr>
									                    <td>
							                    			<span > {{ fileToUpload ? fileToUpload.name : '' }}</span>
						                    			</td>
									                    
									                    <td nowrap class="text-right">
									                        <button type="button" class="btn-sigas button-garnet btn-xs"
									                                (click)="eliminaFilePrincipale()">
									                                <i class="fas fa-trash-alt"></i> Elimina
									                        </button>
									                    </td>
									                </tr>
									                </tbody>
									            </table>
							                    
							                </div>
							              </div>
		                                  
              
								        </div>
								        
								        
								        <div class="row" >
        
										<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
										            <h5 class="border-title">
										                <strong>Allegati </strong> 
										            </h5>
										        </div>
									        <div  class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
									            <sigas-alert [message]="messageTopM" [type]="typeMessageTopM" *ngIf="showMessageTop"></sigas-alert>
									        </div>      
									
									        <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3 text-left" style="padding-top: 30px" >
									            <button *ngIf="(!confermaM && !eliminaM) || (confermaM && eliminaM)" type="button" class="btn-sigas button-green"
									                (click)="fileInput.click()">
									                <i class="fas fa-plus-circle" style="font-size:24px"></i>
									                Aggiungi</button>
									            <span style="visibility: hidden; position: absolute; overflow: hidden; width: 0px; height:0px;border:none;margin:0; padding:0">
									                    <input type="file" #fileInput ng2FileSelect [uploader]="uploaderM" multiple (click)="aggiungiM()"/>
									            </span>
									        </div>
									
									        <div *ngIf="uploaderM.getNotUploadedItems().length" class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="padding-bottom:30px; padding-top: 30px">
									            <table class="table" >
									                <thead>
									                <tr>
									                    <th style="width:60%">Descrizione</th>
									                    <th style="width:20%" >Nome allegati aggiunti</th>
									                    <th style="width:10%"></th> 
									                    <th style="width:10%"></th> 
									                </tr>
									                </thead>
									                <tbody>
									                
									                <tr *ngFor="let item of uploaderM.queue; index as i">
									                	<td> 
									                		<input type="text" class="form-control" placeholder="descrizione"
									                    	[(ngModel)]="item.headers" name="descrizione"    >
									                    </td> 
									                    <td>{{ item?.file?.name }}</td>
									                    
									                    <td class="text-left">
									                        <span *ngIf="item.isError"><i class="fas fa-exclamation-triangle" title="Errore"></i></span>
									                    </td> 
									                    <td nowrap class="text-right">
									                        <button type="button" class="btn-sigas button-garnet btn-xs"
									                                (click)="eliminaFile(item, null)">
									                                <i class="fas fa-trash-alt"></i> Elimina
									                        </button>
									                    </td>
									                </tr>
									                </tbody>
									            </table>
									             <div class="bs-example" data-example-id="single-button-dropdown">
         <div class="form-group row col-lg-12">
             <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                 <div class="btn-group">
									                <button *ngIf="confermaM && eliminaM" type="button" class="btn-sigas button-green"
									                    (click)="confermaAllegato(uploaderM.queue)" >
									                    <i class="fa fa-angle-right glyphicon glyphicon-ok"></i>
									                    Conferma
									                </button>
									                <!-- 
									                <button *ngIf="!confermaM || !eliminaM" type="button" class="btn-sigas button-red"
									                        (click)="uploadMultipli(uploaderM.queue)" >
									                        <i class="fas fa-paperclip  text-red-sigas"></i>
									                        Allega
									                </button> -->
									                <button type="button" class="btn-sigas button-garnet btn-glyphicon"
									                        (click)="eliminaFile(null, uploaderM)" [disabled]="!uploaderM.queue.length">
									                        <i class="fas fa-trash-alt text-garnet-sigas"></i>
									                        Elimina tutti
									                </button>
									            </div>
             </div>
         </div>
     </div>
									        </div>
									    </div>
									    
									    <div *ngIf="sizeAlert" class="alert alert-danger" role="alert">
									        <i class="fas fa-exclamation-triangle"></i><strong>Attenzione!</strong> {{message}}
									    </div>
									    
									    <div *ngIf="numAllegatiAlert" class="alert alert-danger" role="alert">
									        <i class="fas fa-exclamation-triangle"></i><strong>Attenzione!</strong> {{message}}
									    </div>
									    
									    <div *ngIf="descAllegatoAlert" class="alert alert-danger" role="alert">
									        <i class="fas fa-exclamation-triangle"></i><strong>Attenzione!</strong> {{message}} 
									    </div>
    
								        
								 
								 
								
                            	
                            </div>
                        </div>
     <div class="bs-example" data-example-id="single-button-dropdown">
         <div class="form-group row col-lg-12">
         
        
             <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
              <div class="btn-group">
                              <button type="button" (click)="resetForm()" class="btn btn-primary margin-icon btn-standard">
			                  <i class="fas fa-times"></i>
			                  Cancella</button>
                          </div>
                 <div class="btn-group">
                     <button type="submit" [disabled]="!praticaDocumentazione.form.valid || !fileCaricato" class="btn btn-primary margin-icon btn-standard" (click)="salvaDocumentazione()">
                         <i class="fa fa-angle-right glyphicon glyphicon-ok"></i> Conferma</button>
                 </div>
             </div>
         </div>
     </div>
     </div>
    </form>

  </div>
</div>
</div>
